<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Change Maker by IPI</title>
  <link href="https://fonts.googleapis.com/css2?family=Aptos:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* [Your full CSS here—unchanged for brevity] */
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <h1>Change Maker by IPI</h1>
      <div class="logo">
        <img src="https://raw.githubusercontent.com/gmcglynn88/TimeoffApp/main/IPI_Primary%20Identity_Corporate_REVERSED_ECC.png" alt="IPI Logo">
      </div>
    </div>
  </header>

  <div class="app-container">
    <div class="sidebar">
      <div class="sidebar-nav">
        <button class="tablink active" onclick="openTab(event,'wfmManagement')"><i>📊</i> WFM Management Unit Search</button>
        <button class="tablink" onclick="openTab(event,'externalWork')"><i>✉️</i> External Work Creation</button>
        <button class="tablink" onclick="openTab(event,'activityCode')"><i>⚙️</i> Activity Code Management</button>
        <button class="tablink" onclick="openTab(event,'bulkSkills')"><i>🔄</i> Bulk Skill Changes</button>
        <button class="tablink" onclick="openTab(event,'bulkQueues')"><i>🔄</i> Bulk Queue Changes</button>
        <button class="tablink" onclick="openTab(event,'workTeamManagement')"><i>👥</i> Work Team Management</button>
        <button class="tablink" onclick="openTab(event,'intradayPlan')"><i>📅</i> Intraday Weekly Plan</button>
      </div>
    </div>

    <div class="content-area">
      <div class="tab-content-container">
        <div id="wfmManagement" class="tabcontent active">
          <iframe id="frame-wfmManagement"
                  src="https://gmcglynn88.github.io/MU-Search---Changemaker/"
                  style="width:100%; height: calc(100vh - 140px); border:none;"></iframe>
        </div>
        <div id="externalWork" class="tabcontent">
          <iframe id="frame-externalWork"
                  src="https://gmcglynn88.github.io/External-Work-Creation---Changemaker/"
                  style="width:100%; height: calc(100vh - 140px); border:none;"></iframe>
        </div>
        <div id="activityCode" class="tabcontent">
          <iframe id="frame-activityCode"
                  src="https://gmcglynn88.github.io/Activity-code-management---changemaker/"
                  style="width:100%; height: calc(100vh - 140px); border:none;"></iframe>
        </div>
        <div id="bulkSkills" class="tabcontent">
          <iframe id="frame-bulkSkills"
                  src="https://gmcglynn88.github.io/Bulk-Skills-Update---Changemaker/"
                  style="width:100%; height: calc(100vh - 140px); border:none;"></iframe>
        </div>
        <div id="bulkQueues" class="tabcontent">
          <iframe id="frame-bulkQueues"
                  src="https://gmcglynn88.github.io/Bulk-Queue-Updater---Changemaker/"
                  style="width:100%; height: calc(100vh - 140px); border:none;"></iframe>
        </div>
        <div id="workTeamManagement" class="tabcontent">
          <iframe id="frame-workTeamManagement"
                  src="https://gmcglynn88.github.io/Workteam-Management---Chnagemaker/"
                  style="width:100%; height: calc(100vh - 140px); border:none;"></iframe>
        </div>
        <div id="intradayPlan" class="tabcontent">
          <iframe id="frame-intradayPlan"
                  src="https://gmcglynn88.github.io/Intraday-Plan---Changemaker/"
                  style="width:100%; height: calc(100vh - 140px); border:none;"></iframe>
        </div>
      </div>
    </div>
  </div>

  <script>
    // =======================
    //  Global Configuration
    const CLIENT_ID     = '4652c8b5-9117-43c6-8e54-77eeb38aebb8';
    const CLIENT_SECRET = 'txtfN6cb699Lu7tID5n2NSjGwKOU_6NzyghgSk-bVkY';
    const REGION        = 'mypurecloud.ie';
    const REDIRECT_URI  = 'https://gmcglynn88.github.io/IPI-changes-on-the-fly/';
    const AUTH_URL      = `https://login.${REGION}/oauth/authorize`
                        + `?client_id=${CLIENT_ID}`
                        + `&response_type=token`
                        + `&redirect_uri=${encodeURIComponent(REDIRECT_URI)}`;

    // Parse the access_token from the URL fragment
    function getTokenFromHash() {
      const hash = window.location.hash.substring(1);
      const params = new URLSearchParams(hash);
      return params.get('access_token');
    }

    // Kick off OAuth
    let accessToken = getTokenFromHash();
    if (!accessToken) {
      // no token? redirect to Genesys Cloud login
      window.location.href = AUTH_URL;
    } else {
      // clean up URL (remove token from fragment)
      window.history.replaceState({}, '', REDIRECT_URI);
      // once we have a token, push it into each iframe
      document.querySelectorAll('iframe').forEach(frame => {
        frame.addEventListener('load', () => {
          frame.contentWindow.postMessage({
            accessToken,
            region: REGION,
            authUrl: AUTH_URL
          }, new URL(frame.src).origin);
        });
      });
    }

    // Tab logic (unchanged)
    function openTab(evt, name) {
      document.querySelectorAll('.tablink').forEach(btn => btn.classList.remove('active'));
      evt.currentTarget.classList.add('active');
      document.querySelectorAll('.tabcontent').forEach(tc => tc.classList.remove('active'));
      document.getElementById(name).classList.add('active');
    }
  </script>
</body>
</html>
